<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="src/camera.css">
<!-- â‘  ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"></script>
<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script>
<script>
  AFRAME.registerComponent('change-color-with-click', {
      init: function () {
          var markerId = this.el.id;
          console.log(markerId);
          var boxId = markerId + "-box";
          console.log(boxId);
          var box = document.querySelector("#" + boxId);
          console.log(box);
          box.addEventListener('click', function () {
              console.log("Clicked,", markerId);
              box.setAttribute('material', 'color', 'red');
          });
      }
  });
</script>
<body style='margin: 0; overflow: hidden;'>

<!-- ã‚·ãƒ¼ãƒ³ã®è¿½åŠ ã¨ãƒ‡ãƒãƒƒã‚¯UIã‚’éžè¡¨ç¤º -->
<a-scene embedded arjs="debugUIEnabled:false; patternRatio=0.70" vr-mode-ui="enabled: false" gltf-model="dracoDecoderPath: assets/origin/;">
  <a-entity camera look-controls>
    <a-entity cursor="rayOrigin: mouse"></a-entity>
  </a-entity>
  <!-- ã‚¢ã‚»ãƒƒãƒˆã‚’å®šç¾© -->
  <a-assets timeout="100000000">
    <a-asset-item id="grass-gltf" src="assets/grass_weed_model.gltf"></a-asset-item>
  </a-assets>

  <!-- èŠ -->
  <a-marker type='pattern' url='patterns/grass.patt' id="grass" >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="#grass-gltf"
              animation-mixer="loop: pingpong;"
              position="-0.5 0.1 0.5"
              rotation="-90 0 0"
              scale="0.15 0.15 0.15"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" color="#006400" id="grass-box"></a-box>

  </a-marker>

  <!-- ã‚­ãƒªãƒ³ -->
  <a-marker type='pattern' url='patterns/pattern-giraffe.patt' id="giraffe" >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/giraffe.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.01 0.01 0.01"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="giraffe-box"></a-box>

  </a-marker>
  
  <!-- ãƒ‘ãƒ³ãƒ€ -->
  <a-marker type='pattern' url='patterns/pattern-panda.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/panda.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="panda-box" ></a-box>

  </a-marker>

  <!-- ã—ã‚ãã¾ -->
 <a-marker type='pattern' url='patterns/pattern-white_bear.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/white_bear.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="white_bear-box" ></a-box>

  </a-marker>
  <!-- ãƒ©ã‚¤ã‚ªãƒ³ -->
  <a-marker type='pattern' url='patterns/pattern-lion.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/lion.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="lion-box" ></a-box>

  </a-marker>
  <!-- å­é¹¿ -->
  <a-marker type='pattern' url='patterns/pattern-fawn.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/fawn.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="fawn-box" ></a-box>

  </a-marker>
  <!-- ãƒ¯ãƒ‹ -->
  <a-marker type='pattern' url='patterns/pattern-aligator.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/aligator.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="aligator-box" ></a-box>

  </a-marker>
  <!-- è±¡ -->
  <a-marker type='pattern' url='patterns/pattern-elephant.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/elephant.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="elephant-box" ></a-box>

  </a-marker>
  <!-- ã‚¢ãƒ©ã‚¤ã‚°ãƒž -->
  <a-marker type='pattern' url='patterns/pattern-racoon.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/racoon.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="racoon-box" ></a-box>

  </a-marker>
  <!-- ã­ã“ -->
  <a-marker type='pattern' url='patterns/pattern-cat.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/cat.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="cat-box" ></a-box>

  </a-marker>
  <!-- ã‚­ãƒ„ãƒ -->
  <a-marker type='pattern' url='patterns/pattern-fox.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/fox.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="fox-box" ></a-box>

  </a-marker>
  <!-- ã²ã¤ã˜ -->
  <a-marker type='pattern' url='patterns/pattern-sheep.patt' >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="url(assets/origin/sheep.glb)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true" id="sheep-box" ></a-box>

  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<!-- ã‚«ãƒ¡ãƒ©ã®ãƒœã‚¿ãƒ³ -->
<div class="ui">
  <img id="snap">
  <a href="#" id="delete-photo" title="Delete Photo" class="disabled"><i class="material-icons">delete</i></a>
  <a href="" id="take-photo" title="Take Photo"><i class="material-icons">photo_camera</i></a>
  <a href="#" id="download-photo" download="selfie.png" title="Save Photo" class="disabled" target="_blank"><i class="material-icons">file_download</i></a>
</div>
</body>
<script>
  var image = document.querySelector('#snap');
  var take_photo_btn = document.querySelector('#take-photo');
  var delete_photo_btn = document.querySelector('#delete-photo');
  var download_photo_btn = document.querySelector('#download-photo');

  //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒœã‚¿ãƒ³
  take_photo_btn.addEventListener("click", function (e) {
      e.preventDefault();
      var video = document.querySelector('video');
      var snap = takeSnapshot(video);

      //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆè¡¨ç¤º.
      image.setAttribute('src', snap);
      image.classList.add('visible');

      // å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ä¿å­˜ãƒœã‚¿ãƒ³æœ‰åŠ¹
      delete_photo_btn.classList.remove("disabled");
      download_photo_btn.classList.remove("disabled");

      // ä¿å­˜ãƒœã‚¿ãƒ³ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ¸¡ã™
      download_photo_btn.href = snap;
  });

  //å‰Šé™¤ãƒœã‚¿ãƒ³
  delete_photo_btn.addEventListener("click", function(e){

      e.preventDefault();

      // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’éš ã™
      image.setAttribute('src', "");
      image.classList.remove("visible");

      // å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ä¿å­˜ãƒœã‚¿ãƒ³ç„¡åŠ¹
      delete_photo_btn.classList.add("disabled");
      download_photo_btn.classList.add("disabled");

  });

  //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹
  function takeSnapshot(video) {
      var resizedCanvas = document.createElement("canvas");
      var resizedContext = resizedCanvas.getContext("2d");
      var width = video.videoWidth;
      var height = video.videoHeight;
      var aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");

      if (width && height) {
          //videoã®ã‚µã‚¤ã‚ºã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ã‚»ãƒƒãƒˆ
          resizedCanvas.width = width;
          resizedCanvas.height = height;
          //ã‚­ãƒ£ãƒ³ãƒã‚¹ã«videoã‚’ã‚³ãƒ”ãƒ¼
          resizedContext.drawImage(video, 0, 0, width, height);

          //ã‚«ãƒ¡ãƒ©ã®ç”»è§’ã§arå´ã®ç¸®å°å‡¦ç†ã‚’å¤‰ãˆã‚‹
          if (width > height) {
              // æ¨ªé•·ï¼ˆPC)
              resizedContext.drawImage(aScene, 0, 0, width, height);
          } else {
              // ç¸¦é•·ï¼ˆã‚¹ãƒžãƒ›ï¼‰
              var scale = height / width;
              var scaledWidth = height * scale;
              var marginLeft = (width - scaledWidth) / 2;
              resizedContext.drawImage(aScene, marginLeft, 0, scaledWidth, height);
          }
          return resizedCanvas.toDataURL('image/png');
      }
  }
  var image = document.querySelector('#snap');
  var take_photo_btn = document.querySelector('#take-photo');
  var delete_photo_btn = document.querySelector('#delete-photo');
  var download_photo_btn = document.querySelector('#download-photo');

  //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒœã‚¿ãƒ³
  take_photo_btn.addEventListener("click", function (e) {
      e.preventDefault();
      var video = document.querySelector('video');
      var snap = takeSnapshot(video);

      //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆè¡¨ç¤º.
      image.setAttribute('src', snap);
      image.classList.add('visible');

      // å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ä¿å­˜ãƒœã‚¿ãƒ³æœ‰åŠ¹
      delete_photo_btn.classList.remove("disabled");
      download_photo_btn.classList.remove("disabled");

      // ä¿å­˜ãƒœã‚¿ãƒ³ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ¸¡ã™
      download_photo_btn.href = snap;
  });

  //å‰Šé™¤ãƒœã‚¿ãƒ³
  delete_photo_btn.addEventListener("click", function(e){
      e.preventDefault();

      // ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’éš ã™
      image.setAttribute('src', "");
      image.classList.remove("visible");

      // å‰Šé™¤ãƒœã‚¿ãƒ³ã¨ä¿å­˜ãƒœã‚¿ãƒ³ç„¡åŠ¹
      delete_photo_btn.classList.add("disabled");
      download_photo_btn.classList.add("disabled");
  });

  //ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹
  function takeSnapshot(video) {
      var resizedCanvas = document.createElement("canvas");
      var resizedContext = resizedCanvas.getContext("2d");
      var width = video.videoWidth;
      var height = video.videoHeight;
      var aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");

      if (width && height) {
          //videoã®ã‚µã‚¤ã‚ºã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ã‚»ãƒƒãƒˆ
          resizedCanvas.width = width;
          resizedCanvas.height = height;
          //ã‚­ãƒ£ãƒ³ãƒã‚¹ã«videoã‚’ã‚³ãƒ”ãƒ¼
          resizedContext.drawImage(video, 0, 0, width, height);

          //ã‚«ãƒ¡ãƒ©ã®ç”»è§’ã§arå´ã®ç¸®å°å‡¦ç†ã‚’å¤‰ãˆã‚‹
          if (width > height) {
              // æ¨ªé•·ï¼ˆPC)
              resizedContext.drawImage(aScene, 0, 0, width, height);
          } else {
              // ç¸¦é•·ï¼ˆã‚¹ãƒžãƒ›ï¼‰
              var scale = height / width;
              var scaledWidth = height * scale;
              var marginLeft = (width - scaledWidth) / 2;
              resizedContext.drawImage(aScene, marginLeft, 0, scaledWidth, height);
          }
          return resizedCanvas.toDataURL('image/png');
      }
  };
</script>
</html>
