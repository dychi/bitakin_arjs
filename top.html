<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="src/camera.css">
<!-- â‘  ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.2/aframe/build/aframe-ar.js"></script>
<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script>
<script src="https://raw.githubusercontent.com/youmustfight/aframe-asset-lazy-load/master/dist/aframe-asset-layz-load.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
<script>
  var firebaseConfig = {
      apiKey: "AIzaSyBUO2wBPzdE-VFuUca4ETGWJ56vwLw4LEs",
      authDomain: "arbitakin.firebaseapp.com",
      databaseURL: "https://arbitakin.firebaseio.com",
      projectId: "arbitakin",
      storageBucket: "arbitakin.appspot.com",
      messagingSenderId: "432978750455",
      appId: "1:432978750455:web:827596c9b6750372"
  };
  firebase.initializeApp(firebaseConfig);
    dict = {}
    checkOnceMeetUser = [];
    AFRAME.registerComponent('registerevents', {
        init: function () {
            var email = localStorage.getItem('email');
            // index.htmlã‹ã‚‰ç”»é¢é·ç§»ã—ã¦ãã¦ã„ãªã„å ´åˆã€index.htmlã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ã‹ã‘ã‚‹
            if (!email) {
                document.location.href = "https://dychi.github.io/bitakin_arjs";
            }
            var marker = this.el;
            window.count = 0;
            window.updates = {};
            window.name = dict[email];
//            firebase.database().ref('animalName').set({ name: count});

            marker.addEventListener('markerFound', function () {
                var markerId = marker.id;
                //åˆå›ã®èª­ã¿è¾¼ã¿ã®å ´åˆã¯idå = è‡ªåˆ†
                if (Object.keys(dict).length == 0) {
                    dict[email] = markerId;
                    console.log('markerId:' + markerId);
                } else {
                    name = dict[email];
                    console.log('markerId:' + markerId);
                    console.log('name:' + name);
                    console.log(markerId.startsWith(name));
                    // è‡ªåˆ†ã®marker + åŒã˜gltfectã¯countã—ãªã„
                    // if (name != markerId || markerId.startsWith(name) != true)
                    if (name != markerId) {
                        console.log('count:' + count)
                        //??????????????????
                        console.log('marker:' + checkOnceMeetUser.indexOf(markerId));
                        if (checkOnceMeetUser.indexOf(markerId) == -1) {
                            ++count
                            updates['/' + 'animalName' + '/' + name] = count
                            firebase.database().ref().update(updates);
                            checkOnceMeetUser.push(markerId);
                        }
                    }
                }
            });
            marker.addEventListener('markerLost', function () {
                console.log('Marker Lost');
            });
        }
    });
</script>
<script>
  AFRAME.registerComponent('change-color-with-click', {
      init: function () {
          var markerId = this.el.id;
          console.log(markerId);
          var boxId = markerId + "-box";
          console.log(boxId);
          var box = document.querySelector("#" + boxId);
          console.log(box);
          box.addEventListener('click', function () {
              console.log("Clicked,", markerId);
              box.setAttribute('material', 'color', 'red');
          });
      }
  });
</script>
<script src="src/camera.js"></script>
<body style='margin: 0; overflow: hidden;'>

<!-- ã‚·ãƒ¼ãƒ³ã®è¿½åŠ ã¨ãƒ‡ãƒãƒƒã‚¯UIã‚’éè¡¨ç¤º -->
<a-scene embedded arjs="debugUIEnabled:false;patternRatio:0.70">
  <a-entity camera look-controls>
    <a-entity cursor="rayOrigin: mouse"></a-entity>
  </a-entity>
  <!-- ã‚¢ã‚»ãƒƒãƒˆã‚’å®šç¾© -->
  <a-assets>
    <a-asset-item id="grass-gltf" src="assets/grass_weed_model.gltf"></a-asset-item>
    <a-asset-item id="lion-gltf" src="assets/origin/lion.gltf"></a-asset-item>
  </a-assets>

  <!-- èŠ -->
  <a-marker type='pattern' url='patterns/grass.patt' id="grass" >
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="#grass-gltf"
              animation-mixer="loop: pingpong;"
              position="-0.5 0.1 0.5"
              rotation="-90 0 0"
              scale="0.05 0.05 0.05"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã‚­ãƒªãƒ³ -->
  <a-marker type='pattern' url='./patterns/pattern-giraffe.patt' id="giraffe" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/giraffe.gltf)"
              lazy-load="delay: 1000;src: url(assets/origin/giraffe.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.01 0.01 0.01"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ãƒ‘ãƒ³ãƒ€ -->
  <a-marker type='pattern' url='patterns/pattern-panda.patt' id="panda" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/panda.gltf)"
              lazy-load="delay: 1000;src: url(assets/origin/panda.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0.8"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã—ã‚ãã¾ -->
 <a-marker type='pattern' url='patterns/pattern-white_bear.patt' id="white_bear" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/white_bear.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ãƒ©ã‚¤ã‚ªãƒ³ -->
  <a-marker type='pattern' url='patterns/bigAnimals/big-pattern-lion.patt' id="lion" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="#lion-gltf"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0.5"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- å­é¹¿ -->
  <a-marker type='pattern' url='patterns/pattern-fawn.patt' id="fawn" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/fawn.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0.8"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ãƒ¯ãƒ‹ -->
  <a-marker type='pattern' url='patterns/pattern-aligator.patt' id="aligator" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/aligator.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- è±¡ -->
  <a-marker type='pattern' url='patterns/pattern-elephant.patt' id="elephant" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/elephant.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã‚¢ãƒ©ã‚¤ã‚°ãƒ -->
  <a-marker type='pattern' url='patterns/pattern-racoon.patt' id="racoon" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/racoon.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0.5"
              rotation="-90 0 0"
              scale="0.02 0.02 0.02"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã­ã“ -->
  <a-marker type='pattern' url='patterns/pattern-cat.patt' id="cat" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/cat.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 1 0"
              rotation="-90 0 0"
              scale="0.03 0.03 0.03"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã‚­ãƒ„ãƒ -->
  <a-marker type='pattern' url='patterns/pattern-fox.patt' id="fox" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/fox.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>


  <!-- ã²ã¤ã˜ -->
  <a-marker type='pattern' url='patterns/pattern-sheep.patt' id="sheep" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/sheep.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 0.8"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>

  <!-- å±•ç¤ºãƒ©ã‚¤ã‚ªãƒ³ -->
  <a-marker type='pattern' url='patterns/bigAnimals/big-pattern-lion.patt' id="big-lion" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="#lion-gltf"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>

  <!-- å±•ç¤ºã²ã¤ã˜ -->
  <a-marker type='pattern' url='patterns/bigAnimals/big-pattern-sheep.patt' id="big-sheep" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/sheep.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>
    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>

  <!-- å±•ç¤ºè±¡ -->
  <a-marker type='pattern' url='patterns/bigAnimals/big-pattern-elephant.patt' id="big-elephant" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/elephant.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>
    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>

  <!-- å±•ç¤ºãƒ‘ãƒ³ãƒ€ -->
  <a-marker type='pattern' url='patterns/bigAnimals/big-pattern-panda.patt' id="big-panda" registerevents>
    <!-- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ  -->
    <a-entity gltf-model="src: url(assets/origin/panda.gltf)"
              animation-mixer="loop: pingpong;"
              position="0 0.1 1"
              rotation="-90 0 0"
              scale="0.015 0.015 0.015"
              shadow="receive: true"></a-entity>
    <a-box position="0 0.5 0" wireframe="true"></a-box>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<!-- ã‚«ãƒ¡ãƒ©ã®ãƒœã‚¿ãƒ³ -->
<div class="ui">
  <img id="snap">
  <a href="#" id="delete-photo" title="Delete Photo" class="disabled"><i class="material-icons">delete</i></a>
  <a href="" id="take-photo" title="Take Photo"><i class="material-icons">photo_camera</i></a>
  <a href="#" id="download-photo" download="selfie.png" title="Save Photo" class="disabled" target="_blank"><i class="material-icons">file_download</i></a>
</div>
</body>
</html>
